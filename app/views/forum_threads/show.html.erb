<div class="card mb-3">
  <div class="card-block px-3 py-2">
    <h1 class="card-title"><%= @forum_thread.title %></h1>
  </div>
  <% if user_privileged?(current_user, @forum_thread) %>
    <p><%= link_to @forum_thread.user.username, user_path(@forum_thread.user), class: 'card-link col-3' %></p>
    <div class="card-footer px-3 py-1">
      <%= link_to 'Edit thread', edit_forum_thread_path(@forum_thread), class: 'card-link' %>
      
      <%= link_to 'Delete thread', forum_thread_path(@forum_thread), method: :delete, data: { confirm: 'Are you sure you want to delete this thread?' }, class: 'card-link' %>
    </div>
  <% else %>
    <p class="col-3"><%= @forum_thread.user.username %></p>
  <% end %>
</div>

<% @forum_thread.forum_posts.each do |post| %>
  <% next unless post.persisted? %>
  <div class="card mb-2">
    <% if user_privileged?(current_user, post) %>
      <div class="card-block px-3 py-2">
        <p><%= link_to post.user.username, user_path(post.user), class: 'card-link' %></p>
        <p><%= post.message %></p>
      </div>
      <div class="card-footer px-3 py-1">
        <%= link_to 'Edit post', edit_forum_post_path(post), class: 'card-link' %>

        <%= link_to 'Delete post', forum_post_path(post), method: :delete, data: { confirm: 'Are you sure you want to delete this post?' }, class: 'card-link delete-post' %>
      </div>
    <% else %>
      <div class="card-block px-3 py-2">
        <p><%= post.user.username %></p>
        <p><%= post.message %></p>
      </div>
    <% end %>
  </div>
<% end %>
<% if current_user %>
  <%= render partial: "forum_posts/form", locals: { button_label: 'Post' } %>
<% else %>
  <%= link_to 'Reply', login_path, class: 'btn btn-light btn-lg mt-1'  %>
<% end %>
